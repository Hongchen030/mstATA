% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mst_design.R
\name{mst_design}
\alias{mst_design}
\title{Create an mstATA_design Object}
\usage{
mst_design(
  itempool,
  item_id_col = "item_id",
  design,
  rdp = NULL,
  diff_levels = NULL,
  exclude_pathways = NULL,
  module_length = NULL,
  pathway_length = NULL,
  item_module_eligibility = NULL,
  pivot_stim_map = NULL,
  enemyitem_set = NULL,
  enemystim_set = NULL
)
}
\arguments{
\item{itempool}{A \code{data.frame} containing the item pool. Each row represents
one item and may include metadata such as item ID, difficulty, content category,
or stimulus membership.}

\item{item_id_col}{A character string giving the column name in \code{itempool}
that uniquely identifies items.}

\item{design}{A character string specifying the MST design. The string encodes
the number of modules per stage and may use commas (\code{,}), dashes
(\code{-}), or slashes (\code{/}) as separators.
For example, \code{"1-3-3"}, \code{"1,3,3"}, and \code{"1/3/3"} all define
an MST with 1 module in stage 1, 3 modules in stage 2, and 3 modules in stage 3.}

\item{rdp}{Optional list specifying routing decision points for each
stage transition in a multistage test. Default is NULL. See Details.}

\item{diff_levels}{Optional named list of difficulty labels, indexed by the number
of modules in each stage. If \code{NULL}, default labels are used for up to
five modules per stage. If any stage has more than five modules and
\code{diff_levels} is not provided, difficulty labels are omitted.}

\item{exclude_pathways}{Optional character vector specifying disallowed pathways.
Each element must be a string of the form \code{"x-y-z"}, where each number
refers to a module index at the corresponding stage. This is commonly used to
prohibit extreme transitions (e.g., routing from an easy module directly to
a hard module).}

\item{module_length}{Optional numeric vector giving the number of items in each
module. The length must match the number of modules implied by \code{design}.}

\item{pathway_length}{Optional numeric scalar specifying the total number of items
in each pathway. All pathways must have equal length if this argument is used.}

\item{item_module_eligibility}{Optional named list specifying item eligibility
by module. List names correspond to (a subset of) module indices (within a single panel),
and each element is a vector of item indices eligible for that module.
If omitted, all items are eligible for that module.}

\item{pivot_stim_map}{Optional. A precomputed stimulus–item mapping created by
\code{\link{create_pivot_stimulus_map}}. Required for stimulus-based constraints.}

\item{enemyitem_set}{Optional. A precomputed enemy item set created by
\code{\link{create_enemy_sets}} (and optionally combined via
\code{\link{concat_enemy_sets}}). Required for enemy-item constraints.}

\item{enemystim_set}{Optional. A precomputed enemy stimulus set created by
\code{\link{create_enemy_sets}} (and optionally combined via
\code{\link{concat_enemy_sets}}). Required for enemy-stimulus constraints.}
}
\value{
An object of class \code{"mstATA_design"} with the following components:
\describe{
\item{ItemPool}{The original item pool.}
\item{item_id_col}{A character string giving the column name in \code{ItemPool}
that uniquely identifies items.}
\item{pivot_stim_map}{Optional verified stimulus mapping object with components
\code{pivot_item_id}, \code{stimulus_name},
\code{stimulus_members}, and \code{numItems_stimulus}.}
\item{enemyitem_set}{Optional verified enemy item set containing
\code{ExclusionPair}, \code{EnemySet}, and derived \code{ItemIndex}.}
\item{enemystim_set}{Optional verified enemy stimulus set containing
\code{ExclusionPair}, \code{EnemySet}, and derived \code{PivotIndex}.}
\item{NumStages}{Number of stages in the MST design.}
\item{NumModules}{Number of modules in the MST design.}
\item{NumPathways}{Number of allowed pathways.}
\item{RDP}{Optional verified routing decision points.}
\item{ModuleIndex}{A \code{data.frame} describing module structure by stage.
If \code{module_length} is supplied, includes a \code{ModuleLength} column.}
\item{PathwayIndex}{A \code{data.frame} describing allowed pathways and their
total lengths. If difficulty labels are available, includes pathway labels.}
\item{decisionvar_name}{Character vector of decision variable names
(one panel).}
\item{decisionvar_type}{Character vector of decision variable types
(currently all binary).}
}
}
\description{
Constructs an \code{mstATA_design} object from an item pool and a multistage test (MST)
design. The resulting object encodes the full structural
information required for automated test assembly, including module structure,
pathway structure, decision variables, and optional \strong{preprocessing} artifacts
such as stimulus mappings and enemy relationships.
}
\details{
\strong{1. Routing decision points}

The list must have length \code{NumStages - 1}. Each element corresponds
to routing after a given stage and must be a numeric vector whose length
equals the number of modules in the next stage minus one.

For example, in a three-stage 1–3–3 design:
\preformatted{
rdp = list(
  c(-0.5, 0.5),  # routing after stage 1
  c(-1, 1)       # routing after stage 2
)
}

The ordering of values within each vector defines adjacency among
modules in the next stage.

\strong{2. module_length or pathway_length}

Exactly one of \code{module_length} or \code{pathway_length} must be specified.

\itemize{
\item If \code{module_length} is provided, modules at the same stage are checked (must
have equal length). Pathway lengths are computed automatically.
\item If \code{pathway_length} is provided, all pathways are assumed to have
equal length and module lengths are not explicitly stored.
\item If both are provided, consistency between the implied and supplied
pathway lengths is checked.
}

\strong{3. item_module_eligibility set}

By default, all items are eligible for all modules, yielding a fully flexible
module-explicit formulation with decision variables
\eqn{x_{m,i,p}} indicating whether item \eqn{i} is selected in module \eqn{m}
of panel \eqn{p}. Item usage constraints ensure uniqueness within a pathway
or across a panel.

When \code{item_module_eligibility} is supplied, decision variables are created
only for eligible item–module combinations. This reduces model size while
preserving flexibility near module boundaries and avoids rigid item partitioning.
}
\examples{
# mini item pool
data("mini_itempool")
# Example 1: 1-3-3 design with varying module lengths
mst_design(itempool = mini_itempool,design = "1-3-3",
               module_length = c(6, 4, 4, 4, 3, 3, 3),pathway_length = NULL)

# Example 2: 1-3-3 design with fixed pathway length and excluded REH and RHE pathways
mst_design(itempool = mini_itempool,design = "1-3-3",
               exclude_pathways = c("1-1-3", "1-3-1"),
               module_length = NULL,pathway_length = 13)
# Example 3: 1-3-3 design, with item_module_eligibility provided
item_module_eligibility<-list(`1`=1:nrow(mini_itempool),
                              `2`=which(mini_itempool$difficulty<=0),
                              `4`=which(mini_itempool$difficulty>=0))
### selected items in routing module no item-level requirement,
### selected items in S2E, difficulty below 0
### selected items in S2H, difficulty above 0

mst_design(itempool = mini_itempool,design = "1-3-3",
           module_length = c(6,4,4,4,3,3,3),
           item_module_eligibility = item_module_eligibility)

}
\references{
Xiong, X. (2018). A hybrid strategy to construct multistage adaptive tests.
\emph{Applied Psychological Measurement}, 42(8), 630–643.{doi:10.1177/0146621618762739}
}
\seealso{
\code{\link{create_pathways}},
\code{\link{create_pivot_stimulus_map}},
\code{\link{create_enemy_sets}},
\code{\link{concat_enemy_sets}}
}
