% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stimquant_con.R
\name{stimquant_con}
\alias{stimquant_con}
\title{Generate Stimulus-Level Constraints Requiring Stimulus-Level Quantitative Attributes
to Be Greater Than, Less Than, or Within a Specified Range}
\usage{
stimquant_con(
  x,
  attribute,
  min = NULL,
  max = NULL,
  which_module = NULL,
  which_pathway = NULL
)
}
\arguments{
\item{x}{An object of class \code{"mstATA_design"} created by \code{mst_design()}.}

\item{attribute}{A string giving the column name in \code{x$ItemPool} that represents the quantitative attribute for the stimulus.}

\item{min}{A numeric scalar for the lower bound.}

\item{max}{A numeric scalar for the upper bound.}

\item{which_module}{Integer vector of modules. Must be consistent with the choices made in
\code{test_stimcount_con()}, \code{test_stimcat_con()},
and \code{test_stimquant_con()}.}

\item{which_pathway}{Integer vector of pathways. Must be consistent with the choices made in
\code{test_stimcount_con()}, \code{test_stimcat_con()},
and \code{test_stimquant_con()}.}
}
\value{
An object of S3 class \code{"mstATA_constraint"} with named elements:
\describe{
\item{name}{A character vector indicating the specifications in each row of \code{A_binary}}
\item{specification}{A \code{data.frame} summarizing the constraint specification, including
the requirement name, attribute, constraint type, application level,
operator, and the number of constraint rows generated.}
\item{A_binary}{A sparse binary matrix representing the linear constraint coefficients.}
\item{A_real}{NULL for 'mstATA_constraint' object}
\item{operators}{A character vector of constraint operators, one per row of \code{A_binary}.}
\item{d}{A right-hand-side vector of 1s or 0s depending on whether \code{select} is \code{TRUE} or \code{FALSE}.}
\item{C_binary}{NULL for 'mstATA_constraint' object}
\item{C_real}{NULL for 'mstATA_constraint' object}
\item{sense}{NULL for 'mstATA_constraint' object}
}
}
\description{
This function generates linear constraints ensuring that each selected stimulus
satisfies a specified quantitative requirement (e.g., stimulus word count, stimulus
difficulty, readability index).

This constraint can be enforced at the \code{"Module-level"}, \code{"Pathway-level"}, or
\code{"Panel-level"}. It should be mentioned that the formulation requires
stimulus-level attributes to be strictly positive.

The number of generated linear constraints depends on the application level:

\itemize{
\item \strong{Module-level:} when \code{which_module} is provided and
\code{which_pathway = NULL}

The number of constraints is
\strong{(number of stimuli) x (number of modules specified) x side}

\item \strong{Pathway-level:} when \code{which_pathway} is provided and
\code{which_module = NULL}

The number of constraints is
\strong{(number of stimuli) x (number of unique modules in specified pathways) x side}

\item \strong{Panel-level:} both \code{which_module} and \code{which_pathway} are \code{NULL}

The number of constraints is
\strong{(number of stimuli) x (total number of modules) x side}
}

where \code{side = 1} for one-sided constraints (min-only or max-only)
and \code{side = 2} when both \code{min} and \code{max} are provided and
\code{min â‰  max}.
}
\details{
\strong{1. Specification}

The constraint enforced is:

\strong{Every selected stimulus must satisfy the required stimulus-level quantitative attribute bound(s).}

\itemize{
\item The attribute type is \emph{quantitative}.
\item The attribute is defined at the \emph{stimulus level} in the item pool.
\item Application levels:
\itemize{
\item \strong{Module-level}: enforce stimuli selected in specific module(s) satisfy the quantitative requirement.
\item \strong{Pathway-level}: enforce stimuli selected in any module of a pathway satisfy the quantitative requirement.
\item \strong{Panel-level}: enforce stimuli selected in the panel satisfy the quantitative requirement.
}
}

\strong{2. Important Restriction}

This function assumes that all stimulus-level quantitative attributes
\eqn{q_s} are strictly positive.

If stimulus attributes may be zero or negative (e.g., stimulus-level difficulty,
centered difficulty values), this constraint formulation does not correctly enforce quantitative
bounds. In such cases, users should instead apply stimulus-level selection
logic using \code{item_module_eligibility()} inside \code{mst_design()}, which
filters eligible stimuli (and linked items) before assembly.

For example, to require all routing-module stimuli to have text feature scores
between \eqn{-1} and \eqn{1}, users should filter stimuli into the routing
module eligibility set using \code{item_module_eligibility()}.
}
\section{Mathematical Formulation}{


Suppose the item pool contains (S - 1) stimulus-based item sets, indexed by
\eqn{s = 1, \ldots, S - 1}. Each stimulus has a designated pivot item,
indexed by \eqn{i_s^{*}}. In addition, the pool contains a set of discrete
(non-stimulus-based) items, which are represented by a dummy stimulus
\eqn{s = S} to allow a unified indexing scheme. Items belonging to stimulus
\eqn{s} are indexed as \eqn{i_s = 1, 2, \ldots, I_s}.

Suppose there are \eqn{M} modules in an MST panel. Let
\eqn{m = 1, \ldots, M} denote the module index.

Let \eqn{q_s} be the quantitative attribute value of stimulus \eqn{s}.

One-sided upper-bound constraint:

\deqn{
  q_s \, x_{i_s^{*},m} \le b_q^{stim,max},  \qquad s = 1, \ldots, S - 1.
}

One-sided lower-bound constraint:

\deqn{
  b_q^{stim,min} \, x_{i_s^{*},m} \le q_s,  \qquad s = 1, \ldots, S - 1.
}

For two-sided range constraints, both inequalities are included.
(\code{min} and \code{max} both provided and not
equal), the number of constraints is doubled (\code{side = 2}).
For one-sided constraints, \code{side = 1}.

Here:
\itemize{
\item \eqn{x_{i_s^{*},m}} indicates whether the pivot item for stimulus
s is selected into module m, thereby indicating whether the
stimulus s is selected in that module.

\item \eqn{q_s} (\strong{must be positive values}) denote the values of the quantitative attribute for stimulus s.

\item \eqn{b_q^{stim,min}} and \eqn{b_q^{stim,max}} are the lower and
upper allowable bounds for the attribute \eqn{q_s}.
}
}

\examples{
data("reading_itempool")
pivot_stim_map <- create_pivot_stimulus_map(
  itempool   = reading_itempool,
  stimulus   = "stimulus",
  pivot_item = "pivot_item"
)

test_mstATA <- mst_design(
  itempool      = reading_itempool,
  design        = "1-3-3",
  module_length = c(14, 12, 12, 12, 12, 12, 12),
  pivot_stim_map = pivot_stim_map
)

# Every selected stimulus in the routing module has 80-110 words.
stimquant_con(
  x = test_mstATA,
  attribute = "stimulus_words",
  min = 80, max = 110, which_module =1
)
}
