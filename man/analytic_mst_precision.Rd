% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/analytic_mst_precision.R
\name{analytic_mst_precision}
\alias{analytic_mst_precision}
\title{Evaluate MST designs via recursive score-distribution propagation}
\usage{
analytic_mst_precision(
  design,
  icc_by_mod,
  cut_scale = "score",
  cuts,
  range_tcc = c(-5, 5),
  tol = 1e-04
)
}
\arguments{
\item{design}{A character string specifying the MST design. The string encodes
the number of modules per stage and may use commas (\code{,}), dashes
(\code{-}), or slashes (\code{/}) as separators.
For example, \code{"1-3-3"}, \code{"1,3,3"}, and \code{"1/3/3"} all define
an MST with 1 module in stage 1, 3 modules in stage 2, and 3 modules in stage 3.}

\item{icc_by_mod}{List of ICC objects indexed by module.
Each element must be a named list over a common ability grid
(e.g., \code{"theta=-1"}, \code{"theta=0"}, ...), where each element is an
item-by-category probability matrix compatible with
\code{\link{module_score_dist}}.}

\item{cut_scale}{Character string indicating the scale of routing cuts.
Must be one of \code{"score"} or \code{"theta"}. Default is "score".}

\item{cuts}{List of length \code{NumStages - 1}.Each element is a numeric
vector of internal cuts defining routing thresholds for the next stage.}

\item{range_tcc}{Numeric length-2 vector giving the search interval for
inverse TCC evaluation (passed to \code{\link{inv_tcc_from_icc}}). Defaults is (-5,5).}

\item{tol}{A convergence tolerance used for inverse TCC calculations. Default is 1e-4.}
}
\value{
A list with components:
\itemize{
\item \code{cdist_by_mod}: module-level score distributions
\item \code{joint_dist}: stage-wise joint score distributions by prefix
\item \code{prefix_table}: prefix-to-module lookup tables by stage
\item \code{icc_path}: pathway-level ICC objects
\item \code{inv_theta_by_path}: score-to-theta lookup tables
\item \code{eval_tb}: data.frame with columns
\code{theta, mu, sigma2, bias, csem}
}
}
\description{
Computes conditional bias and conditional standard error of measurement (CSEM)
for a multistage test (MST) panel using a recursion-based evaluation method.
The implementation follows the logic of \code{irtQ::reval_mst()}, propagating
score distributions stage by stage conditional on true ability \eqn{\theta},
applying routing rules, and mapping final scores to reported ability estimates
via inverse test characteristic curves (TCCs).

This function assumes that item- and module-level response category
probabilities (ICCs) have already been computed on a fixed ability grid.
}
\details{
\strong{1. Recursion-based analytic evaluation}

The analytic evaluation proceeds in four conceptual steps:

\enumerate{
\item \strong{Module score distributions}

For each module, the conditional score distribution
\eqn{P(S_m \mid \theta)} is computed from item response category
probabilities using \code{\link{module_score_dist}}.

\item \strong{Stage-wise recursion with routing}

Joint (cumulative) score distributions are built recursively across
stages. At each stage, examinees are deterministically assigned
to next-stage modules based on their observed cumulative score and the
predefined score cut points for that stage.

\item \strong{Cut score normalization}:

Routing cut scores are defined at the stage level and shared across all prefixes.
If \code{cut_scale = "theta"}, cut scores are converted once per prefix to the
score scale using the prefix-specific test characteristic curve (TCC). These
cumulative score thresholds may be non-integer; observed
scores are integers and are compared against the real-valued cut points
during routing.

\item \strong{Exact joint score propagation}

For each valid routing branch, the cumulative score distribution is
updated by convolving the previous-stage score distribution with the
score distribution of the next module.

\item \strong{Inverse TCC and conditional moments}

Final pathway-specific score distributions are mapped to reported ability
estimates via inverse test characteristic curves (ITCCs). The conditional
mean (bias) and conditional variance (CSEM) are
computed at each true ability value \eqn{\theta}.
}

\strong{2. Conditional bias and conditional SEM}

Let \eqn{S} denote the cumulative test score and
\eqn{\hat\theta(S)} the ITCC estimator.

For each true ability value \eqn{\theta}, this function computes:

\deqn{
  \mu(\theta) = E[\hat\theta \mid \theta], \quad
  \sigma^2(\theta) = \mathrm{Var}(\hat\theta \mid \theta)
}

where the expectation is taken with respect to the exact joint score
distribution induced by the MST routing rules.
}
\section{Mathematical Formulation}{


Let \eqn{\theta \in \Theta} denote a true ability value on a discrete grid.
Consider a multistage test (MST) consisting of \eqn{T} stages, where at each
stage exactly one module is administered according to deterministic routing
rules that map observed cumulative scores to modules.

\strong{(a) Module score distributions}

For module \eqn{m}, let \eqn{S_m} denote the module score. Conditional on
ability \eqn{\theta}, the module score distribution is
\deqn{
  P(S_m = s \mid \theta),
}
which is obtained by analytically combining item response category
probabilities under the specified IRT model. This distribution is computed
independently for each module using \code{\link{module_score_dist}}.

\strong{(b) Stage-wise recursion with routing}

Let \eqn{S^{(t)}} denote the cumulative score after stage \eqn{t}.
At each stage \eqn{t}, examinees are assigned to a
next-stage module \eqn{m_{t+1}} according to score cut points
\eqn{c^{(t)}_1, \dots, c^{(t)}_{K_t}} defined on the cumulative score scale.

The routing rule can be written as a deterministic mapping
\deqn{
  m_{t+1} = r_t\!\left(S^{(t)}\right),
}
where \eqn{r_t(\cdot)} maps observed cumulative scores to modules at stage
\eqn{t+1}.

\strong{(c) Exact joint score propagation}

For a given routing branch induced by the realized cumulative score, the
cumulative score evolves as
\deqn{
  S^{(t+1)} = S^{(t)} + S_{m_{t+1}}.
}

Conditional on \eqn{\theta}, the joint score distribution is updated
analytically via convolution:
\deqn{
  P\!\left(S^{(t+1)} = s \mid \theta\right)
  =
  \sum_{u}
  P\!\left(S^{(t)} = u \mid \theta\right)
  P\!\left(S_{m_{t+1}} = s-u \mid \theta\right),
}
where the sum is taken over all reachable values of \eqn{S^{(t)}} along the
routing branch.

\strong{(d) Inverse TCC and conditional moments}

Let \eqn{S = S^{(T)}} denote the final cumulative test score, and let
\eqn{\hat\theta(S)} be the reported ability estimate obtained by applying the
inverse test characteristic curve (TCC) associated with the administered
pathway determined by the routing rules.

For each true ability value \eqn{\theta}, the conditional mean and conditional
variance of the reported ability are defined as
\deqn{
  \mu(\theta) = E[\hat\theta(S) \mid \theta],
  \qquad
  \sigma^2(\theta) = \mathrm{Var}(\hat\theta(S) \mid \theta),
}
where the expectation is taken with respect to the exact joint distribution
\eqn{P(S \mid \theta)} induced by the MST routing rules.

Explicitly,
\deqn{
  \mu(\theta)
  =
  \sum_{s} \hat\theta(s)\, P(S = s \mid \theta),
}
and
\deqn{
  \sigma^2(\theta)
  =
  \sum_{s} \bigl[\hat\theta(s) - \mu(\theta)\bigr]^2
  P(S = s \mid \theta).
}
}

\references{
Lim, H., Davey, T., & Wells, C. S. (20201).A recursion-based analytical approach to evaluate the performance of MST.
\emph{Journal of Educational Measurement}, 58(2), 154--178.{doi:10.1111/jedm.12276}
}
\seealso{
\code{\link[=analytic_mst_precision_items]{analytic_mst_precision_items()}},\code{\link[=module_score_dist]{module_score_dist()}},\code{\link[=joint_module_score_dist]{joint_module_score_dist()}},
\code{\link[=normalize_cut_scores]{normalize_cut_scores()}},\code{\link[=inv_tcc_from_icc]{inv_tcc_from_icc()}}
}
