% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test_itemcat_con.R
\name{test_itemcat_con}
\alias{test_itemcat_con}
\title{Generate Module- or Pathway-Level Constraints for the Minimum, Exact,
or Maximum Number of Items from Specific Categorical Levels}
\usage{
test_itemcat_con(
  x,
  attribute,
  cat_levels,
  operator,
  target_num,
  which_module = NULL,
  which_pathway = NULL
)
}
\arguments{
\item{x}{An object of class \code{"mstATA_design"} created by \code{mst_design()}.}

\item{attribute}{A string giving the column name in \code{x$ItemPool} that
contains the \strong{item categorical attribute}.}

\item{cat_levels}{A character string or vector of categorical levels to be
constrained.}

\item{operator}{A character string specifying the inequality or equality
operator. Must be one of \code{"<="}, \code{"="}, or \code{">="}.
For range-based constraints, use \code{test_itemcat_range_con()} instead.}

\item{target_num}{A matrix or scalar/vector specifying the required number of items for
the category levels in \code{cat_levels}. If scalar/vector is provided, it expands to a matrix.
See \strong{Details}.}

\item{which_module}{Optional integer vector of module indices to which the constraints
apply.}

\item{which_pathway}{Optional integer vector of pathway indices to which the
constraints apply.}
}
\value{
An object of S3 class \code{"mstATA_constraint"} with named elements:
\describe{
\item{name}{A character vector indicating the specifications in each row of \code{A_binary}}
\item{specification}{A \code{data.frame} summarizing the constraint specification, including
the requirement name, attribute, constraint type, application level,
operator, and the number of constraint rows generated.}
\item{A_binary}{A sparse binary matrix representing the linear constraint coefficients.}
\item{A_real}{NULL for 'mstATA_constraint' object}
\item{operators}{A character vector of constraint operators, one per row of \code{A_binary}.}
\item{d}{A numeric vector of right-hand-side values for the constraints.}
\item{C_binary}{NULL for 'mstATA_constraint' object}
\item{C_real}{NULL for 'mstATA_constraint' object}
\item{sense}{NULL for 'mstATA_constraint' object}
}
}
\description{
This function generates a linear constraint matrix enforcing a minimum,
exact, or maximum number of items from specified categorical
levels (e.g., content area, item format).

Constraints may apply at the:
\itemize{
\item \strong{"Module-level"} — each module is treated as an independent test form
\item \strong{"Pathway-level"} — each pathway is treated as an independent test form
}

The total number of constraints depends on the application level and the
number of category levels specified in \code{cat_levels}:

\itemize{
\item \strong{Module-level:} when \code{which_module} is provided
OR both \code{which_module} and \code{which_pathway} are \code{NULL}

The number of constraints is
\strong{(number of category levels)× (number of modules specified)}

\item \strong{Pathway-level:} when \code{which_pathway} is provided and
\code{which_module = NULL}

The number of constraints is
\strong{(number of category levels) × (number of pathways specified)}
}

Users may constrain a subset of modules or pathways using the
\code{which_module} or \code{which_pathway} arguments, and may restrict the
constraint to specific categories using \code{cat_levels}.
}
\details{
\strong{1. Specification}

The constraint enforces:

\strong{The test must meet a minimum, exact, or maximum number of items from the specified categories.}

Key characteristics:

\itemize{
\item The attribute type is \emph{categorical}.
\item The attribute is defined at the \emph{item level} in the item pool.
\item The constraints are applied at either \strong{"Module-level"} or \strong{"Pathway-level"}.
}

\strong{2. target_num}

The constraint level is determined by which selection argument is provided:

\itemize{

\item \strong{Module-level}:
\itemize{
\item Requires the minimum/exact/maximum number of items from specified category levels
to be selected in specified module.
\item Expanded \code{target_num} matrix:
each row = one specified module, each column = one specified category.
}

\item \strong{Pathway-level}:
\itemize{
\item Requires the minimum/exact/maximum number of items from specified category levels
to be selected across the modules belonging to specified pathway.
\item Expanded \code{target_num} matrix:
each row = one specified pathway, each column = one specified category.
}

}
}
\section{Mathematical Formulation}{


Suppose the item pool contains (S - 1) stimulus-based item sets, indexed by
\eqn{s = 1, \ldots, S - 1}. Each stimulus has a designated pivot item,
indexed by \eqn{i_s^{*}}. In addition, the pool contains a set of discrete
(non–stimulus-based) items, which are represented by a dummy stimulus
\eqn{s = S} to allow a unified indexing scheme. Items belonging to stimulus
\eqn{s} are indexed as \eqn{i_s = 1, 2, \ldots, I_s}.

Suppose there are \eqn{M} modules in an MST panel. Let
\eqn{m = 1, \ldots, M} denote the module index.

Let \eqn{V_c^{item}} denote the set of
items that belong to category c.

\strong{1. Module-level constraint (for module m)}

\deqn{\sum_{s=1}^{S} \sum_{i_s \in V_c^{item}} x_{i_s,m} \;\substack{\le \\ \ge \\ =}\; n_c^{m}}

\strong{2. Pathway-level constraint (for pathway r)}

\deqn{\sum_{m \in r} \sum_{s=1}^{S} \sum_{i_s \in V_c^{item}} x_{i_s,m} \;\substack{\le \\ \ge \\ =}\; n_c^{r}}

Here:
\itemize{
\item \eqn{x_{i_s,m}} is the binary decision variable indicating whether
item \eqn{i_s} is selected into module m.

\item \eqn{m \in r} denote modules belonging to pathway r.

\item The stacked operator, \eqn{\substack{\leq \\ \geq \\ =}} denotes that the specification may take the form of an upper bound, lower bound, or exact value.

\item \eqn{n_c^{m}} specify the required number of items from category level c in module m.

\item \eqn{n_c^{r}} specify the required number of items from category level c in pathway r.
}
}

\examples{
data("mini_itempool")

test_mstATA <- mst_design(
  itempool = mini_itempool,
  design = "1-3-3",
  module_length = c(4,2,2,2,2,2,2)
)
# Example 1: category constraints across modules in the same stage
con1<-test_itemcat_con(x = test_mstATA,attribute = "itemtype",cat_levels = c("MC","TEI"),
                                       operator = "=",target_num = c(3,1),
                                       which_module = 1,which_pathway = NULL)
con2<-test_itemcat_con(x = test_mstATA,attribute = "itemtype",cat_levels = c("MC","TEI"),
                                       operator = "=",target_num = c(2,0),
                                       which_module = 2:4,which_pathway = NULL)
con3<-test_itemcat_con(x = test_mstATA,attribute = "itemtype",cat_levels = c("MC","TEI"),
                                       operator = "=",target_num = c(2,0),
                                       which_module = 5:7,which_pathway = NULL)
# Example 2: category constraints per pathway
test_mstATA<-mst_design(itempool = mini_itempool,design = "1-3-3",
                          exclude_pathways = c("1-1-3","1-3-1"),pathway_length = 8)
test_itemcat_con(x = test_mstATA,
                             attribute ="itemtype",cat_levels = c("MC","TEI"),
                             operator = "=",
                             target_num = c(7,1),
                             which_pathway = 1:7)

# Example 3: constraints on combinations of categorical attributes
mini_itempool$content_itemtype <-
  paste(mini_itempool$content, mini_itempool$itemtype)

test_mstATA <- mst_design(
  itempool = mini_itempool,
  design = "1-3-3",
  exclude_pathways = c("1-1-3","1-3-1"),
  pathway_length = 8
)
test_itemcat_con(
  x = test_mstATA,
  attribute = "content_itemtype",
  cat_levels = paste0("content", rep(1:4, each = 2)," ", c("MC","TEI")),
  operator = "=",
  target_num = c(1,1, 1,1, 1,0, 2,1),
  which_pathway = 1:7
)
}
