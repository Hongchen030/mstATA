% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/test_itemcount_con.R
\name{test_itemcount_con}
\alias{test_itemcount_con}
\title{Generate Module- or Pathway-Level Constraints for the Number of Selected Items}
\usage{
test_itemcount_con(x, stage_length_bound = NULL)
}
\arguments{
\item{x}{An object of class \code{"mstATA_design"} created by \code{mst_design()}.}

\item{stage_length_bound}{Optional \code{data.frame} with columns:
\code{stage}, \code{min}, \code{max}, specifying minimum and maximum
allowable numbers of items in each stage.
If \code{NULL}, the default rule is:
\strong{at least one item per stage} (no empty modules), and modules within each stage must have equal lengths.}
}
\value{
An object of S3 class \code{"mstATA_constraint"} with named elements:
\describe{
\item{name}{A character vector indicating the specifications in each row of \code{A_binary}}
\item{specification}{A \code{data.frame} summarizing the constraint specification, including
the requirement name, attribute, constraint type, application level,
operator, and the number of constraint rows generated.}
\item{A_binary}{A sparse binary matrix representing the linear constraint coefficients.}
\item{A_real}{NULL for 'mstATA_constraint' object}
\item{operators}{A character vector of constraint operators, one per row of \code{A_binary}.}
\item{d}{A numeric vector of right-hand-side values for the constraints.}
\item{C_binary}{NULL for 'mstATA_constraint' object}
\item{C_real}{NULL for 'mstATA_constraint' object}
\item{sense}{NULL for 'mstATA_constraint' object}
}
}
\description{
This function generates linear constraints controlling the number of selected
items in each module or pathway of a MST panel.

Depending on the MST design provided in \code{mst_design()}, the constraints
enforce either:

\itemize{
\item \strong{Module-level item counts} – each module is treated as an independent test form
\item \strong{Pathway-level item counts} – each pathway is treated as an independent test form
}

The total number of constraints depends on the MST design and whether
stage-level bounds are used:

\itemize{
\item \strong{Module-level constraints:}
The number of constraints is
\strong{(number of modules)}

\item \strong{Pathway-level constraints:}
The number of constraints is
\strong{(number of pathways) + (number of modules with a min bound) + (number of modules with a max bound)
+ (number of equality constraints enforcing equal module lengths within each stage)}
}
}
\details{
\strong{1. Specification}

The constraint enforces:

\strong{the test must include the exact number of \emph{items}.}.

Key characteristics:

\itemize{
\item The attribute type is \emph{categorical}: each item has a unique ID.
\item The attribute is defined at \emph{item level} in the item pool.
\item The constraint can be enforced at either \strong{"Module-level"} or \strong{"Pathway-level"}.
It depends on whether \code{module_length} or
\code{pathway_length} was specified in \code{mst_design()}.
}

\strong{2. Module-level constraints}

These are generated when \code{module_length} was provided in \code{mst_design()}.

\itemize{
\item The required number of items per module is given by
\code{x$ModuleIndex$ModuleLength}.
\item One constraint is created per module.
\item Each module must contain \emph{exactly} the specified number of items.
}

\strong{3. Pathway-level constraints}

These are generated when \code{pathway_length} was provided in \code{mst_design()}.

\itemize{
\item The required number of items per pathway is given by
\code{x$PathwayIndex$PathwayLength}.

\item Optional stage-level constraints may enforce:
\itemize{
\item Minimum items per stage
\item Maximum items per stage
}

\item If \code{stage_length_bound = NULL}
\itemize{
\item Each stage must contain at least one item
\item All modules within a stage must have equal length
}
}
}
\section{Mathematical Formulation}{


Suppose the item pool contains (S - 1) stimulus-based item sets, indexed by
\eqn{s = 1, \ldots, S - 1}. Each stimulus has a designated pivot item,
indexed by \eqn{i_s^{*}}. In addition, the pool contains a set of discrete
(non–stimulus-based) items, which are represented by a dummy stimulus
\eqn{s = S} to allow a unified indexing scheme. Items belonging to stimulus
\eqn{s} are indexed as \eqn{i_s = 1, 2, \ldots, I_s}.

Suppose there are \eqn{M} modules in an MST panel. Let
\eqn{m = 1, \ldots, M} denote the module index.

\strong{1. Module-level constraint}

\deqn{\sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m} = n_m}

\strong{2. Pathway-level constraint}

\deqn{\sum_{m \in r} \sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m} = n_r}

Stage-level minimum:

\deqn{
  \sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m} \ge n_t^{\min}, \forall m \in \text{stage t}
}

Stage-level maximum:

\deqn{
  \sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m} \le n_t^{\max}, \forall m \in \text{stage t}
}

Equal-length constraint for modules (m, m') in the same stage:

\deqn{
  \sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m} = \sum_{s=1}^{S} \sum_{i_s=1}^{I_s} x_{i_s,m'}
}
Here:
\itemize{
\item \eqn{x_{i_s,m}} is the binary decision variable indicating whether
item \eqn{i_s} is selected into module m.

\item \eqn{m \in r} denote modules belonging to pathway r.

\item \eqn{n_m} specify the required number of items in module m.

\item \eqn{n_r} specify the required number of items in pathway r.

\item \eqn{n_t^{\min}} specify the minimum number of items in stage t.

\item \eqn{n_t^{\max}} specify the maximum number of items in stage t.

\item \eqn{m}, and \eqn{m'} are a pair of modules in stage t.
}
}

\examples{
data("mini_itempool")
# Example 1: module-level test length
# Routing module: 3 items; Stage 2 modules: 4 items each
test_mstATA <- mst_design(
  itempool = mini_itempool,module_length = c(3,4,4,4),
  design = "1-3"
)
test_itemcount_con(test_mstATA)

# Example 2: pathway-level test length: each pathway contains 7 items,
test_mstATA <- mst_design(
  itempool = mini_itempool,pathway_length = 7,
  design = "1-3"
)
# It will also constrain that each module has at least 1 item and modules
# in the stage 2 have the same module length.
test_itemcount_con(test_mstATA)

# Example 3: pathway-level with stage-level max bound for Stage 1
test_itemcount_con(
  test_mstATA,
  stage_length_bound = data.frame(stage = 1, min = 1, max = 2)
)
}
\seealso{
\code{\link[=mst_structure_con]{mst_structure_con()}}
}
